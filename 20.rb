input='##...###...##.#..###.#...#....#..###.##.###...###.##.##.####.#######..######....#.###.##....#.##...#..........#####..##..#..##...##....####.###..#..####.##.##.#....#.##.#.#.#.#..##.##.#...##..##...#.#...#...#..#.#...#.##...#..######.#.##..#.#.#...##.###..########...........#.#.###.#.#..##...#..#..###..#..##.#.#...##..##..###..#####...#.####....#.###....###.##.##...##.#..#.#..####....#..##...##.#####.###.###.###.....##...#.#..#.######.##.##.......###...#.....#...##..#..#.###.#..#..########.##......###..##.#.

###.###...##..#.......#...#...#.#.#.#...#.##.#...##...###..#..#.#.#.#...#..#.#...#...#.##.#.#######.
#...##....#......######.##.#####.#...#.#..#####....##.##...#...###.#.###.##.#..#....#.####...#.....#
.#.#..#.###.##.###....##......##.##.###.#...###.##...###...#.###....##.##...##...##....#..##.###.#.#
##.###.#.#####.#######..#...#.#...#.###....#..#.#......####..##.###....#..#....#.#..#.#.#.##...##.#.
#...........#...#..#..###...###.#..........#.###..#....##...#..#.##..#....###.####..###..#.###.....#
.###.........##..##....#...##...#.....###.#....#.##.#.###.##....#.#.....##.###.....###.###....##.#..
#######.#...#...#..####...#.#####.#...#..#.##......#..##...####.##.###....#.###.#.#.###.####.#..#...
.####..######.#...#.#......#.####..#...#####....#...#.###...........##....##..####..#...###....#.#.#
#.#..##.###.###.#..##..#..###..#.#.#.#...#..##..#####..#.##.....##.##.##..#.##...##.##......#..####.
.#####..#.#.###....#.##.##.####.#...##..#...#.#.#.##.##...##...#.#..#.....#.#.##.##.###.#.........##
.####...#.####...#####..##.####.#.#####...##..###.###.##.#....#.#.#.....###.#.#...#....#.##.#....###
.###.##.#.##..#...#..#.#.###..#.#.##....####..##.###.####........##..###.#..####.#..#####...####.###
##.####..##.##.#.#.####..#...#.....#######...###..#####.#...#.#####.#.##..##.#.##.#...###....#.#...#
.####.....#....#...#.#.#.#.#.##...#..#.#####.#..#.#..##.####.###..#..##...#..##.#..#.#..##.....####.
...##.#...#..###.#####..##.###..#.#.#.#...###..#####.#.#...#..######..#..###########......#...#.##.#
#.#.#####..####..#.####..###......##.#.####..#.##.#..#.#.#...#.#..#...##.##....##.#.#..##..##..####.
#...#######.#..#..####.#..#...#.#......#.##.##..####.##..#..##.##.###.#..###..#...#.##.##.#..#.##.#.
.###..#.##.........#.#..###.####.##.##.#..#######..#.##.#.#...#..#....##.#..##..#.#.###.#..##....#.#
##..###...#...##.##..##.#..##.###.##.#.##########.######.##.##.##.##..#......#.####.......#.#..#..#.
..#.##.#..##...#.....##.##..##.#.#..####.#####....#.#####.........##.#..##.#..##...#...###..#.###...
##..#.#.....#.##..##...##...#......##...#.#..##..##..##....#..#.###...###.###.#.#.#....###.##..##..#
.####..##.###...#.....#.#.###..####..#...##.##.##.#.###..##.##.###....#.##.#####.##.#.##.####..###.#
#.###.##..#.#####...##.#.#.####.##.###.##..##..##.##.###.####.....##.###....#...#.##.#######.##.#.##
..#....#...#....##.##..###.#.####.#.#...##.##....#....####.##..#...##.###..#.....#.....####.###.#.##
##.#...##..##...#.#...##.#.#.#..#.##.##.#.#..#.###.###..#...##...#.####...######.#..#......#...##..#
###.#....#.#...#.#.#..#####..#....#...####.#....#...##.#.##...##.##.#.#####.#..##.#...#...#.#..#.#.#
##...#.#..#.##.#.##..#.#.##.###.##..#.###.##..##..##.#..#....#.####.#..#......########.#.###.#.#...#
##.....#..##...##.##.####.#...##..#.##...#.#.##..#..####..##....######.##...##.####.##..#.##...###..
..###.#.##.#.##.#.#......#.#####..#.#.####.###...##..##..##....#.#...#.##.##..###....#.....#####..##
..#......#.#.#....#.#####.##.##.###..##...##.##.#..##.##....##..##....###....#..##.####...#.#.#.##..
.#.....##.#...#.#..##...#.##..#....#..###...#####..#....#.##..#..##.##.####..#.#...##.##...##..##..#
##.##..###...####....#.#####..#.###...#.###.....######..##.##.##..#.#.#..#..#######..#.#..#.#.#....#
###.##.#...#...###.##.#.#.#..#.####.....#..#.##.##...#.####..##...#.##.#...#...###.#.#...#.#.##..##.
######..#...###..#.....##...#..#######.....#...#.#...##.#..#.###.###.#.#.#...##..###.#.###..###.#.#.
#.#.##.#.#.#####.#######.#..##..#####.#.###..###.#.#...#...#.#....##.###.#..#...#####...###..#...#.#
##.#.....##...##.###..#####.####...##.#.#.#........##.######.#....#.#..#######.###..##...#.#..##.#..
######..#..##...#.##.###...####.#####......#..#####.#.#..#.##.#####.#..#...#.#.#...........###..#.#.
.#####.#####...##.#.#.##.#.#.###.#.##.##.##..###..#..#.##.##.......##...##.#..#.#.#.###.#...#..#....
##..#.######....##.###.##...##..#.#.##..#.##...#.###..#.#....#.....##...###.#.###..######..###.##.#.
.#.#.#.#...###.##....###..#.#.#.#.....#.#.#.####.####.###..##...#.#....#.#....##..#.##.##..##.####..
##.##..#.#....#...#.##.##.....#...#.####.####..#..###.####.#...#.###.....#..#.####.#.......#.#...###
#..#..####..#.#..##..#########...#..########..#..######..#..##..###.#####.#..#.#####.#......#..###..
...#.#.....#....#####..##.##.#.##.###.##.#...#...####....#...####....#####.##...#.##...##.#.#..####.
...#...##..#..#######..#######..#..##.#.##...##.##.#..#..######.#.#.##.###.#.###.####..####.####..#.
###.##.#.##..####.#..#.#...###...#..###..##.####...###...#...#####..###..##.#..##...####..#.##.###.#
..##.#.#.#.#..#..#.#...#.#.#..####...#.#.###..##..##..#..#.#.##...##.##.###.##..#.#.#....##...#.##.#
.....#.#..##....#.#..#.##..#.##...#.#...##..#..####.##.#.##.##...#....#.#.####.###...######.##.....#
#.#.#..#......##.......#...#.#...####..######.##.##..#.###.##..##.#...#.###.....###.#....##.#.#..#.#
#..#####....###..####..##.##.#..#.##.##.#..####.##....#...###.##..####..##..#####......#....#.##...#
#..#.#.#.#.#.##..#.##.#.#....###.#....#.#.######.##.#.......#.######..#...#........#..##.##.##.#####
.#####..##.###.##...##...##.##.#...#..#.###..##.##....##.##..#.#..#.##..#.##..........#...#.#..##..#
#...###.#####..###..#.#######..####..##...#.###.###.###..#.##..###....##.##..#...####.####.#.#...#..
##.#....####.#.#.#.#.#..##..##..##..#....#..#...#.#...##.#.###.#.####.#####....#..##..##.#..#.#.##..
.##...####.##.#.#.#.#..#####....##..##..#..####...##..#...#.#.......#.#.#...#.........##..##.##.#...
..#...#..#####.##.......#####.####..#####...#..##.##..#.#...##..#..#.#.....#.##.##.##....##..#.#####
##....#..##.####.#.......#.##.#.#.#...#.##.#.#....########.###...#.######.###.........##.#........##
#...##.##...#..#..##.#.#...#########.##...##.#.####.####......##.#..#.#.#.#..##........#..##.#######
#.###.#..#.##.#.##.#######.##.##.##..###...#.#.....#.##.#.##.###..##..##..##.#.....##.#...#.....##..
.##.#.##..##..##..###.....#...###....#..#..#....#...#.#....###.#.###..#.#####.###..#.##..###..#..#..
.##.##...#.##..#...##..####...###.####.##.#.####..#....####.#..##..#....##...#......#...####.#.#...#
#..#..####..##...#.####...##....##..####....#.#..####.#.#.##...##.#######.###.##.#.....#.####.#.#..#
....#..##.#.#.#.##.#....##..#..###...##....#..###..#########...###.#.#.#.##..##.....###.####.#.....#
.....####.###.#.####..####.#..##....#..#...#..#...###....#.#.#..###.#.###...##..#....#.#.#.#...###..
###.#.#.#..#.##..#.#.#.#..#####.#.####.#..##.....##.#.##.##.#.##..#.##..#..#.#.#..##..##.#......####
.###..####...#..#.#.##...##.#.#..#....##..#.....#.#.#.#..#.#...#...###.#..#.#.....#...#####...###...
#..##.#.###.#..#.#...#....###.###.#.##.##.##.##..##.#..#.#.###.##..#.#....#..##.####.##.####.#.#..#.
#..##.#....#..#.###...#.##.#..#.#...#.#####..#.###......#.#..#.##..###.##.#..#.......########.###.#.
###.##...#..#..#.##.#..#......#.....#####.###....##.......##...####..##.##..#.##....#..#.###.##....#
...#....#.###.##..#..###...##.###..##..#..#...#...####..#.###.#.#..#####.#.####..###..#.###..##..#..
##.#..#..####.#..#.#.#.#.###...###.##..##.##.#.##.#...##..#.#.####..####..##.##.######.#...#.####...
.#....##.##.##.....###...##.##.#.#.#.###...##.##..#.##.###.....##..######....#.#...#.#..####....#.##
.#.######.#.#...###.#.####.####...###.###..#.#...#.....##.....##...###.##....##.####..##.#.##.....#.
#..##.##.#..##.#......###...####..#..###...##.#####.#....#.##..#.#.##.#.#.#....###..##.##.#.###.###.
####.#..#.##..##.#..#.#.##..######..##.#..#..##.#######.####.#.#..####.....##....###.###.###.#..#..#
#..#.###.##..###.##.#..##.##..####.#.....#.....#..#.#.....#......#..#.##..#.#.#......#..##.###.#..##
......#.#.###.#.##..#...#.###.#..##.###.#...###.##..#..#####.##..##.##.##.###.##.######.#.##...#.###
.....#..###.....#.#.##........#.#...###.#.###.###..#.#.##....#..##.#......#.#..#....####.#.#.#..####
##..#....#.##...#####....#.####.##.#.##..###.##...#.#....#..###.#..#..##.#....#..##.#.##..###....#..
....###..##...#.##..#.#..####.##.##..#.....##.##..###...##.#...#.#####....#..###.#..#.#.##.#.####..#
..#..#.....#..####.......#.#..##..#..##########...##..###......#.....#....##..#..##...#....#.#.#..#.
###.#.#....##..##.###...#.#.....#.......##.###.###...........####...##..##.#...####...#.###..#..##.#
.##...#..###...##.#####.####..#####..##.....##..#.#...##.#...##.#.#.#.#...###..#...#..##..#.#..##.#.
.##....#...##..#.##..####.#....#..##.##..#....#######.####...#.#..#...####..#..###.###..##.###.#.#.#
.........##...#.####...#....#...##.###############.#..#.##..####.#.#.#.....##..#.###..###...#..####.
#...####..####.##...####.#.#...####.####..###..#.....#.###.#.##...#...####.#.#.#....##.#...#..##....
#.#.....##.#.####......#.#.##.##.######..#..###...#.....#..#...##.#..##.#..#...#####.###..#.####.###
.##.###.#..##....##.#.#.....##....##..#.#####.######.###.#####.#..#..#####..##....#.###.#####.#####.
#.#...#...#####.###.#....#.#.###.....#.....##...#...#.#....##.##..###..##.####.#....##..#######.###.
....#...###.###.##.##.....#..#.##.##..#..##...#..#....###......#########.#...#.##..#.###.##..##.##.#
#..##...####.###....##..#.#.#.#..####..#.###.#.#####.##.##.####.##....##..#...##.#...#.####....#####
#..#...###..##.####....##..#.#..#.##.####.###..#..###.##..####.##..##.###.####.##......#..#.###...##
#.#....###.#..#.....#..#.##..###.#...#.....#.###..####.##....##.#..##...###.#####....#.##....#..##.#
..#..#..##....#...######.#.##...#......####..#.#....#.##.##..##..#..#..#..##...##..##.#####....#..##
##.#..###.##..#####..##.##.#...#..##.#.#....###.#.###.#......#.#.#....######..###.###.##.####.#.###.
...##.#...####.###.....#########.....#.###..##..........##..####.###.#.##.#.#..##....#...##.###.###.
.######..###..##...#.####.....#.###.####.....####.#.##.#.##.###.#....##.#..#.#.#..##.###...#.#.###..
#..###.#..##.#.##..###..##..#########..#.#......#..##.#..#.##..###.###.#...#....#....###..#.....#..#
##..##.###......#.#....#..##.#...##...###.###.######..#....####.#.####.#..###..###.####.##.##....##.              
####.#...#...#####..#...##....####..##.#.#....#####.##......#.#.#...#...#...#..##..#.#...#.#...##.#.
###.#.##....##.#####.###...##..##..#####..#.##..#......#.##...#.#....###...##.##..###...#..#..##.##.'.split(/\n\n/)

def get_val(dict,alg,y,x,step)
  str=''
  default=step%2==0 ? '#' : '.'
  for dy in -1..1
    for dx in -1..1
      val=dict[[y+dy,x+dx]] ? dict[[y+dy,x+dx]] : default
      str+=val=='#' ? '1' : '0'
    end
  end
  alg[str.to_i(2)]
end

alg=input[0].chars
input=input[1].split(/\n/)
dict={}

for y in 0..input.length-1
  for x in 0..input[0].length-1
    dict[[y,x]]=input[y][x]
  end
end

min=-1
length=input.length
for step in 1..50 do
  newDict=Marshal.load(Marshal.dump(dict))
  for y in min..length
    for x in min..length
      newDict[[y,x]]=get_val(dict,alg,y,x,step)
    end
  end
  min-=1
  length+=1
  dict=newDict
end

p dict.values.count('#')
